{% extends "base.html" %}
{% block title %}Planes de Suscripci贸n 路 VYM{% endblock %}

{% block content %}

<!-- CARGA EL SDK DE PAYPAL UNA VEZ -->
<script src="https://www.paypal.com/sdk/js?client-id=AcNPU-Pvmt2C7pjnTj38a3JP67D6zW76Do_gz4T_E9MOsgJYuFyoa_21_dsrYxUtlEWS0Rh9-bPPHmZf&vault=true&intent=subscription"></script>

<section class="suscripcion">
  <h2>Planes de Suscripci贸n</h2>
  <p class="suscripcion-desc">
    Apoya el desarrollo del proyecto con una peque帽a contribuci贸n mensual <br>
    Elige el plan que mejor se adapte a ti.
  </p>

  <div class="suscripcion-cards">

    <!-- PLAN GRATIS -->
    <div class="plan-card">
      <h3>Gratis</h3>
      <p class="precio">0 <span>USD/mes</span></p>
      <ul>
        <li>Acceso limitado</li>
        <li>Conversi贸n b谩sica</li>
        <li class="negativo">Sin funciones premium</li>
      </ul>
      <a href="/suscripcion/gratis">
        <button>Usar Gratis</button>
      </a>
    </div>

    <!-- PLAN CON DESPLEGABLE PARA BASICO / PREMIUM -->
    <div class="plan-card">
      <h3>Suscripci贸n Pagada</h3>
      <label for="plan-selector">Elige tu plan:</label>
      <select id="plan-selector">
        <option value="P-2K6973181R3291153NENZEIA">B谩sico - $0.01/mes</option>
        <option value="P-2B842033E5190021MNENZOVQ">Premium - $0.02/mes</option>
      </select>

      <ul id="plan-benefits">
        <li>Acceso a funciones est谩ndar</li>
        <li>Soporte b谩sico por correo</li>
        <li class="negativo">Conversi贸n simult谩nea limitada</li>
      </ul>

      <div id="paypal-button-container"></div>
    </div>

  </div>
</section>

<script>
document.addEventListener("DOMContentLoaded", function() {

  const planSelector = document.getElementById("plan-selector");
  const planBenefits = document.getElementById("plan-benefits");

  // Funci贸n para actualizar beneficios seg煤n plan
  function actualizarBeneficios() {
    const plan = planSelector.value;
    if(plan === "P-2K6973181R3291153NENZEIA") {
      planBenefits.innerHTML = `
        <li>Acceso a funciones est谩ndar</li>
        <li>Soporte b谩sico por correo</li>
        <li class="negativo">Conversi贸n simult谩nea limitada</li>
      `;
    } else if(plan === "P-2B842033E5190021MNENZOVQ") {
      planBenefits.innerHTML = `
        <li>Conversi贸n ilimitada</li>
        <li>Sin anuncios ni restricciones</li>
        <li>Soporte prioritario</li>
      `;
    }
  }

  planSelector.addEventListener("change", actualizarBeneficios);

  // Inicializar bot贸n PayPal
  let currentPlan = planSelector.value;

  function renderPayPalButton(planId) {
    document.getElementById("paypal-button-container").innerHTML = "";
    paypal.Buttons({
      style: { shape: 'pill', color: 'white', layout: 'horizontal', label: 'subscribe' },
      createSubscription: function(data, actions) {
        return actions.subscription.create({ plan_id: planId });
      },
      onApprove: function(data) {
        alert("隆Suscripci贸n creada! ID: " + data.subscriptionID);
        // Aqu铆 puedes redirigir: window.location.href = "/suscripcion/basico_o_premium";
      }
    }).render('#paypal-button-container');
  }

  // Renderizar bot贸n inicial
  renderPayPalButton(currentPlan);

  // Cambiar bot贸n al seleccionar otro plan
  planSelector.addEventListener("change", function() {
    currentPlan = this.value;
    renderPayPalButton(currentPlan);
  });

});
</script>

{% endblock %}
